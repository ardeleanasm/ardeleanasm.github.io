<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Common-Cathode 7-segments display driver implementation in Verilog</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../css/blogstyle.css" />
</head>
<body>
<div class="header"> <a href="../blog.html">&larr; Posts</a> </div>
<header>
<h1 class="title">Common-Cathode 7-segments display driver implementation in Verilog</h1>
</header>
<div class="header">
<a href="../blog.html">← Posts</a>
</div>
<div class="header">
<a href="../blog.html">← Posts</a>
</div>
<div class="header">
<a href="../blog.html">← Posts</a>
</div>
<h3 id="description">Description</h3>
<p>7-segment LED type displays provide a convenient way to display data, like numbers, letters, and typically consist of seven individual LEDs within one single display package. In order to produce the required data ( HEX characters from 0 to 9 and A to F) on the display the correct combination of LED segments need to be illuminated. However, to display BCD information on 7-segments we need to use a BCD to 7 segments decoder like 74LS47 or HC4511.</p>
<p>A 7-segment LED display usually have 8 connections for each LED segment and one that acts as a GND or VCC. There are some displays that have an additional input pin used to display a decimal point. Anyway, in electronics there are 2 types of 7-segment displays:</p>
<ol type="1">
<li><strong>Common Cathode Display</strong> - all the cathode connections of the LED segments are joined together to <strong>Gnd</strong>. This means that a segment is illuminated by applying a logic ‘1’ signal to the <em>Anode</em> terminal. (Img 1a)</li>
<li><strong>Common Anode Display</strong> - all the anode connections of the LED segments are joined together to <strong>Vdd</strong> which means that to illuminate a segment a logic ‘0’ needs to be applied to the <em>Cathode</em> terminal. (Img 1b)</li>
</ol>
<p>{% include img.html img=“/blog/resources/common_cathode_anode_leds.png” title=“Img 1:LED display types” caption=“Img 1:LED display types” %}</p>
<p>{% include img.html img=“/blog/resources/led_scheme.png” title=“Img 2:7-segment display format” caption=“Img 2: 7-segment display format” %}</p>
<p>Considering Img 2 we can create the truth table below. Because we use a common cathode 7 segment display we will have 1 for each illuminated segment and 0 for not illuminated. Since we will design a BCD to 7-segments the values from 10 to 15 are invalid. For there values we will mark the corresponding segment with X, meaning don’t care.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><br />
<span class="math display"><em>X</em><sub>3</sub></span><br />
</th>
<th style="text-align: center;"><br />
<span class="math display"><em>X</em><sub>2</sub></span><br />
</th>
<th style="text-align: center;"><br />
<span class="math display"><em>X</em><sub>1</sub></span><br />
</th>
<th style="text-align: center;"><br />
<span class="math display"><em>X</em><sub>0</sub></span><br />
</th>
<th style="text-align: center;">a</th>
<th style="text-align: center;">b</th>
<th style="text-align: center;">c</th>
<th style="text-align: center;">d</th>
<th style="text-align: center;">e</th>
<th style="text-align: center;">f</th>
<th style="text-align: center;">g</th>
<th style="text-align: center;">Display</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">-</td>
</tr>
</tbody>
</table>
<p>Based on the above table we can express the output as minterm expansions:</p>
<p><br />
<span class="math display"><em>a</em> = <em>F</em><sub>1</sub>(<em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>) = ∑<em>m</em>(0, 2, 3, 5, 7, 8, 9)</span><br />
</p>
<p><br />
<span class="math display"><em>b</em> = <em>F</em><sub>2</sub>(<em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>) = ∑<em>m</em>(0, 1, 2, 3, 4, 7, 8, 9)</span><br />
</p>
<p><br />
<span class="math display"><em>c</em> = <em>F</em><sub>3</sub>(<em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>) = ∑<em>m</em>(0, 1, 3, 4, 5, 6, 7, 8, 9)</span><br />
</p>
<p><br />
<span class="math display"><em>d</em> = <em>F</em><sub>4</sub>(<em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>) = ∑<em>m</em>(0, 2, 3, 5, 6, 8)</span><br />
</p>
<p><br />
<span class="math display"><em>e</em> = <em>F</em><sub>5</sub>(<em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>) = ∑<em>m</em>(0, 2, 6, 8)</span><br />
</p>
<p><br />
<span class="math display"><em>f</em> = <em>F</em><sub>6</sub>(<em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>) = ∑<em>m</em>(0, 4, 5, 6, 8, 9)</span><br />
</p>
<p><br />
<span class="math display"><em>g</em> = <em>F</em><sub>7</sub>(<em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>) = ∑<em>m</em>(2, 3, 4, 5, 6, 8, 9)</span><br />
</p>
<p>Now we can construct the Karnaugh’s Map for each output term and then simplify it to obtain a logic combination of inputs for each output. <strong>Note</strong> that in the following equations we considered 0 instead of X for inputs between 10 and 15.</p>
<p><br />
<span class="math display">$$a=A\overline{B}\overline{C}+\overline{A}(C+\overline{B}\overline{D}+BD)$$</span><br />
</p>
<p><br />
<span class="math display">$$b=\overline{AC}\overline{B}+\overline{A}(CD+\overline{C}\overline{D})$$</span><br />
</p>
<p><br />
<span class="math display">$$c=\overline{B}\overline{C}+\overline{A}(B+D)$$</span><br />
</p>
<p><br />
<span class="math display">$$d=\overline{A}\overline{B}(C+\overline{D})+\overline{A}(C\overline{D}+BD\overline{C})+A\overline{B}\overline{C}$$</span><br />
</p>
<p><br />
<span class="math display">$$e=\overline{D}(\overline{B}\overline{C}+\overline{A}C)$$</span><br />
</p>
<p><br />
<span class="math display">$$f=\overline{A}(B\overline{CD}+\overline{C}\overline{D})+A\overline{B}\overline{C}$$</span><br />
</p>
<p><br />
<span class="math display">$$g=\overline{A}(C\overline{BD}+B\overline{C})+A\overline{B}\overline{C}$$</span><br />
</p>
<h3 id="implementation">Implementation</h3>
<p>{% include img.html img=“/blog/resources/hc4511_block_scheme.png” title=“Img 3:TI HC4511 block scheme” caption=“Img 3: TI HC4511 block scheme” %}</p>
<p>In Img 3 is the block scheme of the TI HC4511 BCD-to-7 segment latch/decoder/driver.</p>
<h4 id="decoder-implementation">Decoder Implementation</h4>
<p>The <strong>decoder</strong> will have 2 input ports ( <em>BL</em> signal, <em>D[0:3]</em>) and one output port, <em>D[0:7]</em>and will contain the implementation of the above equations. Moreover, the output of decoder will be blank ( 0 ) if <strong>BL</strong> signal is 0.</p>
<div id="cb1" class="sourceCode">
<div id="cb1" class="sourceCode">
<div id="cb1" class="sourceCode">
<div class="sourceCode" id="cb1"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">module</span> dec_7seg(</a>
<a class="sourceLine" id="cb1-2" title="2">    datain,bl,dataout</a>
<a class="sourceLine" id="cb1-3" title="3">    );</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="dt">input</span>   [<span class="dv">3</span>:<span class="dv">0</span>]   datain; </a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="dt">input</span>           bl;</a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="dt">output</span>  [<span class="dv">7</span>:<span class="dv">0</span>]   dataout;</a>
<a class="sourceLine" id="cb1-8" title="8">    </a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="kw">assign</span> dataout[<span class="dv">7</span>]=(bl==<span class="bn">1&#39;b0</span>)?<span class="bn">8&#39;b00000000</span>:(datain[<span class="dv">3</span>]&amp;(~datain[<span class="dv">2</span>])&amp;(~datain[<span class="dv">1</span>]))|</a>
<a class="sourceLine" id="cb1-10" title="10">                ((~datain[<span class="dv">3</span>])&amp;(datain[<span class="dv">1</span>]|(((~datain[<span class="dv">2</span>])&amp;(~datain[<span class="dv">0</span>]))|(datain[<span class="dv">2</span>]&amp;datain[<span class="dv">0</span>]))));</a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="kw">assign</span> dataout[<span class="dv">6</span>]=(bl==<span class="bn">1&#39;b0</span>)?<span class="bn">8&#39;b00000000</span>:((~(datain[<span class="dv">3</span>]&amp;datain[<span class="dv">1</span>]))&amp;(~datain[<span class="dv">2</span>]))|</a>
<a class="sourceLine" id="cb1-13" title="13">                        ((~datain[<span class="dv">3</span>])&amp;((datain[<span class="dv">1</span>]&amp;datain[<span class="dv">0</span>])|((~datain[<span class="dv">1</span>])&amp;(~datain[<span class="dv">0</span>]))));</a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15">    <span class="kw">assign</span> dataout[<span class="dv">5</span>]=(bl==<span class="bn">1&#39;b0</span>)?<span class="bn">8&#39;b00000000</span>:((~datain[<span class="dv">2</span>])&amp;(~datain[<span class="dv">1</span>]))|</a>
<a class="sourceLine" id="cb1-16" title="16">                        ((~datain[<span class="dv">3</span>])&amp;(datain[<span class="dv">2</span>]|datain[<span class="dv">0</span>]));</a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18">    <span class="kw">assign</span> dataout[<span class="dv">4</span>]=(bl==<span class="bn">1&#39;b0</span>)?<span class="bn">8&#39;b00000000</span>:</a>
<a class="sourceLine" id="cb1-19" title="19">                ((~datain[<span class="dv">3</span>])&amp;(~datain[<span class="dv">2</span>])&amp;(datain[<span class="dv">1</span>]|(~datain[<span class="dv">0</span>])))|</a>
<a class="sourceLine" id="cb1-20" title="20">                ((~datain[<span class="dv">3</span>])&amp;((datain[<span class="dv">1</span>]&amp;(~datain[<span class="dv">0</span>]))|(datain[<span class="dv">2</span>]&amp;datain[<span class="dv">0</span>]&amp;(~datain[<span class="dv">1</span>]))))|</a>
<a class="sourceLine" id="cb1-21" title="21">                (datain[<span class="dv">3</span>]&amp;(~datain[<span class="dv">2</span>])&amp;(~datain[<span class="dv">1</span>]));</a>
<a class="sourceLine" id="cb1-22" title="22"></a>
<a class="sourceLine" id="cb1-23" title="23">    <span class="kw">assign</span> dataout[<span class="dv">3</span>]=(bl==<span class="bn">1&#39;b0</span>)?<span class="bn">8&#39;b00000000</span>:</a>
<a class="sourceLine" id="cb1-24" title="24">                (~datain[<span class="dv">0</span>])&amp;(((~datain[<span class="dv">2</span>])&amp;(~datain[<span class="dv">1</span>]))|((~datain[<span class="dv">3</span>])&amp;datain[<span class="dv">1</span>]));</a>
<a class="sourceLine" id="cb1-25" title="25"></a>
<a class="sourceLine" id="cb1-26" title="26">    <span class="kw">assign</span> dataout[<span class="dv">2</span>]=(bl==<span class="bn">1&#39;b0</span>)?<span class="bn">8&#39;b00000000</span>:</a>
<a class="sourceLine" id="cb1-27" title="27">        ((~datain[<span class="dv">3</span>])&amp;((datain[<span class="dv">2</span>]&amp;(~(datain[<span class="dv">1</span>]&amp;datain[<span class="dv">0</span>])))|((~datain[<span class="dv">1</span>])&amp;(~datain[<span class="dv">0</span>]))))|</a>
<a class="sourceLine" id="cb1-28" title="28">        (datain[<span class="dv">3</span>]&amp;(~datain[<span class="dv">2</span>])&amp;(~datain[<span class="dv">1</span>]));</a>
<a class="sourceLine" id="cb1-29" title="29"></a>
<a class="sourceLine" id="cb1-30" title="30">    <span class="kw">assign</span> dataout[<span class="dv">1</span>]=(bl==<span class="bn">1&#39;b0</span>)?<span class="bn">8&#39;b00000000</span>:</a>
<a class="sourceLine" id="cb1-31" title="31">            ((~datain[<span class="dv">3</span>])&amp;((datain[<span class="dv">1</span>]&amp;(~(datain[<span class="dv">2</span>]&amp;datain[<span class="dv">0</span>])))|(datain[<span class="dv">2</span>]&amp;(~datain[<span class="dv">1</span>]))))|</a>
<a class="sourceLine" id="cb1-32" title="32">            (datain[<span class="dv">3</span>]&amp;(~datain[<span class="dv">2</span>])&amp;(~datain[<span class="dv">1</span>]));</a>
<a class="sourceLine" id="cb1-33" title="33"></a>
<a class="sourceLine" id="cb1-34" title="34">    <span class="kw">assign</span> dataout[<span class="dv">0</span>]=<span class="bn">1&#39;b0</span>;<span class="co">//dot</span></a>
<a class="sourceLine" id="cb1-35" title="35"><span class="kw">endmodule</span> <span class="co">// decoder</span></a></code></pre></div>
</div>
</div>
</div>
<h4 id="latch-implementation">Latch Implementation</h4>
<p>We can easily implement a D-type latch using an <strong>always</strong> block. We will need 5 ports, 3 for input signals ( data in, enable,<br />
<span class="math display">$$\overline{enable}$$</span><br />
) and 2 for output signals ( q and<br />
<span class="math display">$$\overline{q} $$</span><br />
).</p>
<div id="cb2" class="sourceCode">
<div id="cb2" class="sourceCode">
<div id="cb2" class="sourceCode">
<div class="sourceCode" id="cb2"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">module</span> dlatch(</a>
<a class="sourceLine" id="cb2-2" title="2">    d,q,nq,ena,nena</a>
<a class="sourceLine" id="cb2-3" title="3">    );</a>
<a class="sourceLine" id="cb2-4" title="4">    </a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="dt">input</span>       d;</a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="dt">input</span>       ena;</a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="dt">input</span>       nena;</a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="dt">output</span>  <span class="dt">reg</span> q;</a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="dt">output</span>  <span class="dt">reg</span> nq;</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="kw">always</span> @(d,ena,nena) <span class="kw">begin:</span><span class="dt"> d</span>_latch_procedure</a>
<a class="sourceLine" id="cb2-12" title="12">        <span class="kw">if</span>(ena) <span class="kw">begin</span></a>
<a class="sourceLine" id="cb2-13" title="13">            q&lt;=d;</a>
<a class="sourceLine" id="cb2-14" title="14">            nq&lt;=~d;</a>
<a class="sourceLine" id="cb2-15" title="15">        <span class="kw">end</span> <span class="co">// if( le=&#39;1&#39;)</span></a>
<a class="sourceLine" id="cb2-16" title="16">        <span class="kw">else</span> <span class="kw">begin</span></a>
<a class="sourceLine" id="cb2-17" title="17">        <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-18" title="18"></a>
<a class="sourceLine" id="cb2-19" title="19">    <span class="kw">end</span> <span class="co">// d_latch_procedure</span></a>
<a class="sourceLine" id="cb2-20" title="20"></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="kw">endmodule</span> <span class="co">// dlatch</span></a></code></pre></div>
</div>
</div>
</div>
<h4 id="driver-implementation">Driver Implementation</h4>
<p>The driver will have to set output to 1 if <em>LT</em> (Lamp Test) signal is low, otherwise the output will be transparent to input. In other words, in can be implemented as a latch.</p>
<div id="cb3" class="sourceCode">
<div id="cb3" class="sourceCode">
<div id="cb3" class="sourceCode">
<div class="sourceCode" id="cb3"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">module</span> drv_7seg(</a>
<a class="sourceLine" id="cb3-2" title="2">    lt,inbus,outbus</a>
<a class="sourceLine" id="cb3-3" title="3">    );</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="dt">input</span>               lt;</a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="dt">input</span>       [<span class="dv">7</span>:<span class="dv">0</span>]   inbus;</a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="dt">output</span>  <span class="dt">reg</span> [<span class="dv">7</span>:<span class="dv">0</span>]   outbus;</a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="kw">always</span> @(lt,inbus) <span class="kw">begin :</span><span class="dt"> d</span>rv_7seg</a>
<a class="sourceLine" id="cb3-10" title="10">        <span class="kw">if</span>(lt) <span class="kw">begin</span></a>
<a class="sourceLine" id="cb3-11" title="11">            outbus&lt;=inbus;</a>
<a class="sourceLine" id="cb3-12" title="12">        <span class="kw">end</span> <span class="kw">else</span> <span class="kw">begin</span></a>
<a class="sourceLine" id="cb3-13" title="13">            outbus&lt;=<span class="bn">8&#39;b11111111</span>; </a>
<a class="sourceLine" id="cb3-14" title="14">        <span class="kw">end</span></a>
<a class="sourceLine" id="cb3-15" title="15">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb3-16" title="16"></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="kw">endmodule</span> <span class="co">// drv_7seg</span></a></code></pre></div>
</div>
</div>
</div>
<h4 id="modules-instantiation-and-testbench">Modules Instantiation and testbench</h4>
<p>Now that we have all the modules defined we can create a new module <strong>driver_7_segments</strong> and instantiate them.</p>
<div id="cb4" class="sourceCode">
<div id="cb4" class="sourceCode">
<div id="cb4" class="sourceCode">
<div class="sourceCode" id="cb4"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">module</span> driver_<span class="dv">7</span>_segments(</a>
<a class="sourceLine" id="cb4-2" title="2">    inbus,le,lt,bl,outbus,</a>
<a class="sourceLine" id="cb4-3" title="3">    );</a>
<a class="sourceLine" id="cb4-4" title="4">    </a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="dt">input</span>       [<span class="dv">3</span>:<span class="dv">0</span>]   inbus;      <span class="co">//input data</span></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="dt">input</span>               le;             <span class="co">//latch-enable</span></a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="dt">input</span>               lt;             <span class="co">//lamp-test-&gt;displays 8</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="dt">input</span>               bl;             <span class="co">//blanking-&gt; blank</span></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="dt">output</span> <span class="dt">reg</span>  [<span class="dv">7</span>:<span class="dv">0</span>]   outbus;</a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12">    <span class="dt">wire</span> [<span class="dv">3</span>:<span class="dv">0</span>]  latch_output;</a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="dt">wire</span> [<span class="dv">7</span>:<span class="dv">0</span>]  decoder_output;</a>
<a class="sourceLine" id="cb4-14" title="14"></a>
<a class="sourceLine" id="cb4-15" title="15">    dlatch latch0(.d  (inbus[<span class="dv">0</span>]),.ena (~le),.nena(le),.q  (latch_output[<span class="dv">0</span>]),.nq ());</a>
<a class="sourceLine" id="cb4-16" title="16">    </a>
<a class="sourceLine" id="cb4-17" title="17">    dlatch latch1(.d  (inbus[<span class="dv">1</span>]),.ena (~le),.nena(le),.q  (latch_output[<span class="dv">1</span>]),.nq ());</a>
<a class="sourceLine" id="cb4-18" title="18">    </a>
<a class="sourceLine" id="cb4-19" title="19">    dlatch latch2(.d  (inbus[<span class="dv">2</span>]),.ena (~le),.nena(le),.q  (latch_output[<span class="dv">2</span>]),.nq ());</a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21">    dlatch latch3(.d  (inbus[<span class="dv">3</span>]),.ena (~le),.nena(le),.q  (latch_output[<span class="dv">3</span>]),.nq ());</a>
<a class="sourceLine" id="cb4-22" title="22">    </a>
<a class="sourceLine" id="cb4-23" title="23">    dec_7seg decoder_<span class="dv">7</span>_segments(.datain (latch_output),.bl     (bl),.dataout(decoder_output));</a>
<a class="sourceLine" id="cb4-24" title="24">    </a>
<a class="sourceLine" id="cb4-25" title="25">    drv_7seg driver_<span class="dv">7</span>_segments(.inbus (decoder_output),.lt    (lt),.outbus(outbus));</a>
<a class="sourceLine" id="cb4-26" title="26">   </a>
<a class="sourceLine" id="cb4-27" title="27"><span class="kw">endmodule</span> <span class="co">// segments_driver</span></a></code></pre></div>
</div>
</div>
</div>
<div id="cb5" class="sourceCode">
<div id="cb5" class="sourceCode">
<div id="cb5" class="sourceCode">
<div class="sourceCode" id="cb5"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb5-1" title="1"><span class="ot">`include </span><span class="fl">&quot;testbench/test_inc.v&quot;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">module</span> driver_<span class="dv">7</span>_segments_tb;</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="dt">reg</span>       [<span class="dv">3</span>:<span class="dv">0</span>]   inbus;      <span class="co">//input data</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="dt">reg</span>               le;             <span class="co">//latch-enable</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="dt">reg</span>               lt;             <span class="co">//lamp-test-&gt;displays 8</span></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="dt">reg</span>               bl;             <span class="co">//blanking-&gt; blank</span></a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="dt">wire</span> <span class="dt">reg</span>  [<span class="dv">7</span>:<span class="dv">0</span>]   outbus;</a>
<a class="sourceLine" id="cb5-9" title="9"></a>
<a class="sourceLine" id="cb5-10" title="10">    driver_<span class="dv">7</span>_segments driver(.inbus (inbus),.le (le),.lt (lt),.bl (bl),.outbus(outbus));</a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="kw">initial</span> <span class="kw">begin</span></a>
<a class="sourceLine" id="cb5-13" title="13">        <span class="dt">$dumpfile</span>(<span class="st">&quot;segments_driver_tb.vcd&quot;</span>);</a>
<a class="sourceLine" id="cb5-14" title="14">        <span class="dt">$dumpvars</span>;</a>
<a class="sourceLine" id="cb5-15" title="15"></a>
<a class="sourceLine" id="cb5-16" title="16">        <span class="co">//Lamp Test</span></a>
<a class="sourceLine" id="cb5-17" title="17">        le&lt;=<span class="bn">1&#39;b0</span>;<span class="co">//latch is transparent</span></a>
<a class="sourceLine" id="cb5-18" title="18">        bl&lt;=<span class="bn">1&#39;b1</span>;<span class="co">//blanking is disabled</span></a>
<a class="sourceLine" id="cb5-19" title="19">        inbus&lt;=<span class="bn">4&#39;b0000</span>;<span class="co">//0 on inbus</span></a>
<a class="sourceLine" id="cb5-20" title="20">        lt&lt;=<span class="bn">1&#39;b0</span>;<span class="co">//lamp test enabled</span></a>
<a class="sourceLine" id="cb5-21" title="21">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b11111111</span>);</a>
<a class="sourceLine" id="cb5-22" title="22"></a>
<a class="sourceLine" id="cb5-23" title="23">        <span class="bn">#50</span> </a>
<a class="sourceLine" id="cb5-24" title="24">        <span class="co">//Blanking Test</span></a>
<a class="sourceLine" id="cb5-25" title="25">        le&lt;=<span class="bn">1&#39;b0</span>;<span class="co">//latch is transparent</span></a>
<a class="sourceLine" id="cb5-26" title="26">        bl&lt;=<span class="bn">1&#39;b0</span>;<span class="co">//blanking is enabled</span></a>
<a class="sourceLine" id="cb5-27" title="27">        inbus&lt;=<span class="bn">4&#39;b0000</span>;<span class="co">//0 on inbus</span></a>
<a class="sourceLine" id="cb5-28" title="28">        lt&lt;=<span class="bn">1&#39;b1</span>;<span class="co">//lamp test disabled</span></a>
<a class="sourceLine" id="cb5-29" title="29">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b00000000</span>);        </a>
<a class="sourceLine" id="cb5-30" title="30"></a>
<a class="sourceLine" id="cb5-31" title="31">        <span class="bn">#50</span></a>
<a class="sourceLine" id="cb5-32" title="32">        <span class="co">//test all values</span></a>
<a class="sourceLine" id="cb5-33" title="33">        le&lt;=<span class="bn">1&#39;b0</span>;<span class="co">//latch is transparent</span></a>
<a class="sourceLine" id="cb5-34" title="34">        bl&lt;=<span class="bn">1&#39;b1</span>;<span class="co">//blanking is disabled</span></a>
<a class="sourceLine" id="cb5-35" title="35">        lt&lt;=<span class="bn">1&#39;b1</span>; <span class="co">//lamp test is disabled</span></a>
<a class="sourceLine" id="cb5-36" title="36">        </a>
<a class="sourceLine" id="cb5-37" title="37">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b0000</span>;</a>
<a class="sourceLine" id="cb5-38" title="38">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b11111100</span>);</a>
<a class="sourceLine" id="cb5-39" title="39">        </a>
<a class="sourceLine" id="cb5-40" title="40">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b0001</span>;</a>
<a class="sourceLine" id="cb5-41" title="41">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b01100000</span>);</a>
<a class="sourceLine" id="cb5-42" title="42"></a>
<a class="sourceLine" id="cb5-43" title="43">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b0010</span>;</a>
<a class="sourceLine" id="cb5-44" title="44">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b11011010</span>);</a>
<a class="sourceLine" id="cb5-45" title="45"></a>
<a class="sourceLine" id="cb5-46" title="46">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b0011</span>;</a>
<a class="sourceLine" id="cb5-47" title="47">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b11110010</span>);</a>
<a class="sourceLine" id="cb5-48" title="48"></a>
<a class="sourceLine" id="cb5-49" title="49">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b0100</span>;</a>
<a class="sourceLine" id="cb5-50" title="50">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b01100110</span>);</a>
<a class="sourceLine" id="cb5-51" title="51"></a>
<a class="sourceLine" id="cb5-52" title="52">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b0101</span>;</a>
<a class="sourceLine" id="cb5-53" title="53">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b10110110</span>);</a>
<a class="sourceLine" id="cb5-54" title="54"></a>
<a class="sourceLine" id="cb5-55" title="55">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b0110</span>;</a>
<a class="sourceLine" id="cb5-56" title="56">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b10111110</span>);</a>
<a class="sourceLine" id="cb5-57" title="57"></a>
<a class="sourceLine" id="cb5-58" title="58">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b0111</span>;</a>
<a class="sourceLine" id="cb5-59" title="59">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b11100000</span>);</a>
<a class="sourceLine" id="cb5-60" title="60"></a>
<a class="sourceLine" id="cb5-61" title="61">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b1000</span>;</a>
<a class="sourceLine" id="cb5-62" title="62">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b11111110</span>);</a>
<a class="sourceLine" id="cb5-63" title="63"></a>
<a class="sourceLine" id="cb5-64" title="64">        <span class="bn">#25</span> inbus&lt;=<span class="bn">4&#39;b1001</span>;</a>
<a class="sourceLine" id="cb5-65" title="65">        <span class="bn">#25</span> <span class="ot">`assert</span>(outbus,<span class="bn">8&#39;b11110110</span>);</a>
<a class="sourceLine" id="cb5-66" title="66">    <span class="kw">end</span> <span class="co">// initial</span></a>
<a class="sourceLine" id="cb5-67" title="67"></a>
<a class="sourceLine" id="cb5-68" title="68">    <span class="kw">initial</span> <span class="kw">begin :</span><span class="dt">d</span>ump_proc</a>
<a class="sourceLine" id="cb5-69" title="69">            <span class="dt">$display</span>(<span class="st">&quot;</span><span class="ch">\t\t</span><span class="st">Time</span><span class="ch">\t</span><span class="st">INBUS</span><span class="ch">\t</span><span class="st">/LE</span><span class="ch">\t</span><span class="st">/LT</span><span class="ch">\t</span><span class="st">/BL</span><span class="ch">\t</span><span class="st">OUTBUS&quot;</span>);</a>
<a class="sourceLine" id="cb5-70" title="70">            <span class="dt">$monitor</span>(<span class="st">&quot;%d</span><span class="ch">\t</span><span class="st">%b</span><span class="ch">\t</span><span class="st">%b</span><span class="ch">\t</span><span class="st">%b</span><span class="ch">\t</span><span class="st">%b</span><span class="ch">\t</span><span class="st">%b&quot;</span>,<span class="dt">$time</span>,inbus,le,lt,bl,outbus);</a>
<a class="sourceLine" id="cb5-71" title="71">    <span class="kw">end</span> <span class="co">// dump_proc</span></a>
<a class="sourceLine" id="cb5-72" title="72"><span class="kw">endmodule</span> <span class="co">// segments_driver_tb</span></a></code></pre></div>
</div>
</div>
</div>
<hr />
<h3 id="bibliography">Bibliography</h3>
<ol type="1">
<li><a href="http://www.ti.com/lit/ds/symlink/cd74hc4511.pdf">TI HC4511 Datasheet</a></li>
<li><a href="https://www.electronicshub.org/bcd-7-segment-led-display-decoder-circuit/">Electronics Hub</a></li>
<li><a href="https://www.electronics-tutorials.ws/combination/comb_6.html">Electronics Tutorials</a></li>
</ol>
<div class="header">
<a href="../blog.html">← Posts</a>
</div>
<div class="header">
<a href="../blog.html">← Posts</a>
</div>
<div class="header">
<a href="../blog.html">← Posts</a>
</div>
<div class="header"> <a href="../blog.html">&larr; Posts</a> </div>
</body>
</html>
